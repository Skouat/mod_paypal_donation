<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>
		<title lang="en"><![CDATA[Paypal Donation Mod]]></title>
		<description lang="en"><![CDATA[This MOD add a Paypal Donation page to your site. 

Features :
=> Safely test this MOD with Paypal Sandbox
=> Displaying donation statistics on the Donation page and on the bottom of the forum index page
- Progress bar
- Donation received
- Donation used
- Goal to reach
=> Advanced currencies management : Add/remove/enable/disable
=> Backup currency: I hope no, but if you remove or disable all currencies, a Language Key is defined to provide a backup currency. If the language key does not exist, U.S Dollar will be defined as the default currency.
=> Customize the main donation page, success page and cancel page. You can use BBcode and Language keys.
=> Automatic redirection to the forum after a successfull/cancelled donations.
=> Define and suggest a default donation value

All options are manageable from ACP]]></description>
		<description lang="fr"><![CDATA[Ce MOD ajoute une page de don Paypal à votre forum

Fonctionnalitées :
=> Paypal Sandbox: Tester le MOD en toute tranquilité
=> Affichage des Statistiques de don sur la page des dons ainsi qu'en bas de page de l'index du forum.
- Bar de progression
- Dons reçus
- Dons utilisés
- Objectif des dons à atteindre
=> Gestion avancées des devises : Ajout/suppression/activation/désactivation
=> Devise de secours : En cas de désactivation/suppression de toutes les devises, une clé de langue permet de définir une devise de secours par défaut.
=> Personnaliser les pages des dons, ainsi que les pages de retour au forum (Validation/annulation de dons). Vous pouvez utiliser les BBcode et les clés de langues.
=> Retourner automatiquement vers le forum si la soumission du don a été validé avec succès ou abondonnée.
=> Définir et suggérer une valeur de don par défaut.

Toutes les options sont administrables depuis l'ACP]]></description>
		<author-notes lang="en"><![CDATA[
This MOD is inspired by the Stoker 4.0's "Paypal Donation MOD 1.0.3".
By wanting to add to his MOD the management of the currencies, I met to re-code it completely.
Some displayed features have been kept and improved:
- Stats displaying
- Customizable pages with text
Thanks to Stoker 4.0 to have accepted that I publish this new version of Paypal Donation.

Be careful !!!
If you already have Stoker 4.0's Paypal Donation MOD 1.0.3 or 1.0.4, please remove-it before to install this MOD.
See instructions in /contrib/updates folder]]>
		</author-notes>
		<author-notes lang="fr"><![CDATA[
Ce module est inspiré de "Paypal Donation MOD 1.0.3" de Stoker 4.0.
En voulant ajouter à son MOD la gestion des devises, je me suis retrouvé à entièrement le recoder.
Certaines fonctionnalitées ont été gardées et améliorées:
- Visualisation des statistiques
- Personalisation des pages avec du texte
Merci à Stoker 4.0 d'avoir accepté que je publie cette nouvelle mouture de Paypal Donation.

Attention !!!
Si vous utilisez déjà le MOD Paypal Donation 1.0.3 ou 1.0.4 de Stoker 4.0, désintallez-le avant d'installer ce MOD.
Voir les instructions dans le dossier /contrib/updates]]>
		</author-notes>
		<author-group>
			<author>
				<realname><![CDATA[Skouat]]></realname>
				<username><![CDATA[Skouat]]></username>
				<homepage><![CDATA[http://www.ultima-world.com]]></homepage>
				<contributions-group>
					<contributions status="current" from="2009-08-02" position="Developer"/>
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[Stoker 4.0]]></realname>
				<username><![CDATA[Stoker 4.0]]></username>
				<homepage><![CDATA[http://www.phpbb3bbcodes.com]]></homepage>
				<contributions-group>
					<contributions status="past" position="Initial MOD Developer"/>
				</contributions-group>
			</author>
			<author>
				<realname><![CDATA[Adrien BONNEL]]></realname>
				<username><![CDATA[ABDev]]></username>
				<homepage><![CDATA[http://www.phpbb-forge.com]]></homepage>
				<contributions-group>
					<contributions status="current" from="2012-01-24" position="Debugger"/>
				</contributions-group>
			</author>
		</author-group>

		<mod-version>1.0.1</mod-version>

		<installation>
			<level>easy</level>
			<time>300</time>
			<target-version>3.0.10</target-version>
		</installation>

		<history>
			<entry>
				<date>2012-04-14</date>
				<rev-version>1.0.1</rev-version>
				<changelog lang="en">
					<change>Fix : The setting “Sandbox only for founder” does not work</change>
					<change>Fix : Some code optimisation reported by ABDev (Thanks to him)</change>
					<change>Add: MOD Check version add-on</change>
					<change>Add: Advanced BBCode Box 3 add-on</change>
					<change>Add: Update since the new Stocker 4.0's Paypal Donation 1.0.4</change>
					<change>Other minor code change</change>
				</changelog>
				<changelog lang="fr">
					<change>Correction : Le paramètre “Sandbox pour les fondateurs” ne fonctionne pas</change>
					<change>Correction : Optimisation du code reporté par ABDev (Merci à lui)</change>
					<change>Ajout : Contribution pour MOD Check version</change>
					<change>Ajout : Contribution pour Advanced BBCode Box 3</change>
					<change>Ajout : Fichier de mise à jour de la version 1.0.4 de Paypal Donation de Stocker 4.0</change>
					<change>Autres changement mineur du code</change>
				</changelog>
			</entry>
			<entry>
				<date>2012-04-11</date>
				<rev-version>1.0.0-RC2</rev-version>
				<changelog lang="en">
					<change>Fix: Change code according to the phpBB coding guidelines.</change>
					<change>Fix: If all currencies are disabled, the first currency that is enabled becomes the default currency.</change>
					<change>Fix: Characters with accents are not supported in ACP >> .MOD >> Paypal Donation >> Donation pages.</change>
					<change>Change: HTML usage is replaced by BBcode usage.</change>
					<change>Add: Possibility to define a default donation value.</change>
					<change>Add: Ability to set Paypal Sandbox only for board founder.</change>
					<change>Add: Ability to replace the paypal textbox by a paypal drop-list.</change>
					<change>Some changed code.</change>
				</changelog>
				<changelog lang="fr">
					<change>Correction : Changement du code selon les directive de codage de phpBB.</change>
					<change>Correction : Si toutes les devises sont désactivées, la première devise qui est activée ne devient pas la devise par défaut.</change>
					<change>Correction : Les caractères accentués ne sont pas supportés dans ACP >> .MOD >> Paypal Donation >> Donation pages.</change>
					<change>Modification: L’utilisation du HTML est remplacé par l’utilisation des BBcode.</change>
					<change>Ajout : Il est possible de définir une valeur de dons par défaut.</change>
					<change>Ajout : Possibilité d'autoriser Paypal Sandbox seulement pour les foundateurs du forum.</change>
					<change>Ajout : Possibilité de remplacer la zone de saisie de donation libre par une liste déroulante.</change>
					<change>Divers changement dans le code.</change>
				</changelog>
			</entry>
			<entry>
				<date>2012-01-24</date>
				<rev-version>1.0.0-RC1</rev-version>
				<changelog lang="en">
					<change>First public version...</change>
				</changelog>
				<changelog lang="fr">
					<change>Première version public...</change>
				</changelog>
			</entry>
		</history>
		<link-group>
			<link type="language" href="./contrib/languages/fr.xml" lang="en">fr_FR</link>
			<link type="contrib" href="./contrib/updates/update_100-RC2_to_101.xml" lang="en">Paypal Donation Mod update 1.0.0-RC2 to 1.0.1</link>
			<link type="contrib" href="./contrib/updates/update_100-RC1_to_100-RC2.xml" lang="en">Paypal Donation Mod update 1.0.0-RC1 to 1.0.0-RC2</link>
			<link type="contrib" href="./contrib/updates/update_Stoker-4.0-Paypal-Donation-MOD-103_to_Paypal-Donation-MOD-101.xml" lang="en">Update from “Stoker 4.0's Paypal Donation MOD 1.0.3” to “Paypal Donation MOD 1.0.1”</link>
			<link type="contrib" href="./contrib/updates/update_Stoker-4.0-Paypal-Donation-MOD-104_to_Paypal-Donation-MOD-101.xml" lang="en">Update from “Stoker 4.0's Paypal Donation MOD 1.0.4” to “Paypal Donation MOD 1.0.1”</link>
			<link type="contrib" href="./contrib/add-ons/addon_mod_check_version/mod_version_check.xml" lang="en">Add-on for “MOD Version Check” MOD</link>
			<link type="contrib" href="./contrib/add-ons/addon_advanced_bbcode_box_3/advanced_bbcode_box_3.xml" lang="en">Add-on for “Advanced BBCode Box 3” MOD</link>
		</link-group>
	</header>
	<action-group>
		<copy>
			<file from="root/donate.php" to="donate.php" />
			<file from="root/install_donation_mod.php" to="install_donation_mod.php" />
			<file from="root/adm/style/acp_donation.html" to="adm/style/acp_donation.html" />
			<file from="root/images/donation/*.*" to="images/donation/*.*" />
			<file from="root/includes/acp/*.*" to="includes/acp/*.*" />
			<file from="root/includes/functions_donation.php" to="includes/functions_donation.php" />
			<file from="root/language/en/mods/*.*" to="language/en/mods/*.*" />
			<file from="root/styles/prosilver/imageset/en/donate.gif" to="styles/prosilver/imageset/en/donate.gif" />
			<file from="root/styles/prosilver/template/donate/*.*" to="styles/prosilver/template/donate/*.*" />
			<file from="root/styles/prosilver/theme/donation.css" to="styles/prosilver/theme/donation.css" />
			<file from="root/umil/*.*" to="umil/*.*" />
		</copy>
		<open src="index.php">
			<edit>
				<find><![CDATA[$user->setup('viewforum');]]></find>
				<action type="after-add"><![CDATA[//-- mod : Paypal donation --------------------------------------------------------
//-- add
if ($config['donation_enable'] && $config['donation_stats_index_enable'])
{
	$user->add_lang('mods/donate');
	include($phpbb_root_path . 'includes/functions_donation.' . $phpEx);
}
//-- end : Paypal donation --------------------------------------------------------
]]></action>
			</edit>
			<edit>
				<find><![CDATA[// Output page]]></find>
				<action type="before-add"><![CDATA[//-- mod : Paypal donation --------------------------------------------------------
//-- add
if ($config['donation_enable'] && $config['donation_stats_index_enable'])
{
	$template->assign_vars(array(
		'DONATION_STATS_INDEX_ENABLE'	=> (!empty($config['donation_stats_index_enable'])) ? true : false,
		'DONATION_RAISED_ENABLE'		=> (!empty($config['donation_raised_enable'])) ? true : false,
		'DONATION_RAISED'				=> (!empty($config['donation_raised'])) ? $config['donation_raised'] : 0,
		'DONATION_GOAL_ENABLE'			=> (!empty($config['donation_goal_enable'])) ? true : false,
		'DONATION_GOAL'					=> (!empty($config['donation_goal'])) ? $config['donation_goal'] : 0,
		'DONATION_USED_ENABLE'			=> (!empty($config['donation_used_enable'])) ? true : false,
		'DONATION_USED'					=> (!empty($config['donation_used'])) ? $config['donation_used'] : 0,
		'DONATION_CURRENCY_ENABLE'		=> (!empty($config['donation_currency_enable'])) ? true : false,
		'DONATION_CURRENCY'				=> donation_item_list((int) $config['donation_default_currency'], 'currency', 'default_currency', $user->lang['CURRENCY_DEFAULT']),
	));

	if ($config['donation_goal_enable'] && (int) $config['donation_goal'] > 0)
	{
		donation_percent_stats('GOAL_NUMBER', (int) $config['donation_raised'], (int) $config['donation_goal']);
	}

	if ($config['donation_used_enable'] && (int) $config['donation_raised'] > 0 && (int) $config['donation_used'] > 0)
	{
		donation_percent_stats('USED_NUMBER', (int) $config['donation_used'], (int) $config['donation_raised']);
	}
}
//-- end : Paypal donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="viewonline.php">
			<edit>
				<find><![CDATA[		default:
			$location = $user->lang['INDEX'];
			$location_url = append_sid("{$phpbb_root_path}index.$phpEx");
		break;]]></find>
				<action type="before-add"><![CDATA[//-- mod : Paypal Donation --------------------------------------------------------
//-- add
		case 'donate':
			$location = $user->lang['VIEWING_DONATE'];
			$location_url = append_sid("{$phpbb_root_path}donate.$phpEx");
		break;
//-- end : Paypal Donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="includes/constants.php">
			<edit>
				<find><![CDATA[// Additional tables]]></find>
				<action type="after-add"><![CDATA[//-- mod : Paypal Donation --------------------------------------------------------
//-- add
define('DONATION_ITEM_TABLE',			$table_prefix . 'donation_item');
//-- end : Paypal Donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="includes/functions.php">
			<edit>
				<find><![CDATA[		'A_COOKIE_SETTINGS'		=> addslashes('; path=' . $config['cookie_path'] . ((!$config['cookie_domain'] || $config['cookie_domain'] == 'localhost' || $config['cookie_domain'] == '127.0.0.1') ? '' : '; domain=' . $config['cookie_domain']) . ((!$config['cookie_secure']) ? '' : '; secure')),
	));
]]></find>
				<action type="after-add"><![CDATA[//-- mod : Paypal Donation --------------------------------------------------------
//-- add
	if ((!empty($config['donation_enable']) && !empty($config['donation_account_id'])) || (!empty($config['paypal_sandbox_enable']) && !empty($config['paypal_sandbox_address'])))
	{
		$template->assign_vars(array(
			'U_DONATE'			=> append_sid("{$phpbb_root_path}donate.$phpEx"),
			'S_DONATE_ENABLED'	=> true,
		));
	}
//-- end : Paypal Donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="language/en/common.php">
			<edit>
				<find><![CDATA[?>]]></find>
				<action type="before-add"><![CDATA[//-- mod : Paypal Donation --------------------------------------------------------
//-- add
$lang = array_merge($lang, array(
	'DONATEINDEX'				=> 'Donate',
	'VIEWING_DONATE'			=> 'Viewing Donation page',
));
//-- end : Paypal Donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/index_body.html">
			<edit>
				<find><![CDATA[<!-- IF NEWEST_USER -->]]></find>
				<action type="before-add"><![CDATA[<!-- IF DONATION_STATS_INDEX_ENABLE and (DONATION_RAISED_ENABLE or DONATION_GOAL_ENABLE or DONATION_USED_ENABLE) -->
	<!-- INCLUDE donate/donate_stats.html -->
<!-- ENDIF -->
]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/overall_header.html">
			<edit>
				<find><![CDATA[				<li class="icon-faq"><a href="{U_FAQ}" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>]]></find>
				<action type="before-add"><![CDATA[				<!-- IF S_DONATE_ENABLED --><li class="icon-bump"><a href="{U_DONATE}">{L_DONATEINDEX}</a></li><!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/theme/stylesheet.css">
			<edit>
				<find><![CDATA[@import url("colours.css");]]></find>
				<action type="after-add"><![CDATA[@import url("donation.css");
]]></action>
			</edit>
		</open>
		<php-installer><![CDATA[install_donation_mod.php]]></php-installer>

		<diy-instructions lang="en"><![CDATA[Upload all included files.
Run the installer.
Set the Paypal Donation Mod settings under the .MOD tab.]]></diy-instructions>
		<diy-instructions lang="fr"><![CDATA[Transféer tous les fichiers.
Executer le fichier d'installation.
Définir les paramètres de Paypal Donation Mod depuis l'ACP dans l'onglet ".MOD".]]></diy-instructions>
	</action-group>
</mod>