<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>
		<title lang="en"><![CDATA[Paypal Donation Mod]]></title>
		<description lang="en"><![CDATA[With this MOD you can : 
- Enable/disable stats about donations (progress bar, donation received, goal to reach) on the Donation Page. In addtion, can be displayed on the bottom of the forum index page.
- Manage currency you want to active.
- Automatic redirection to the forum after a successfull/cancelled donations.
- Customize with a text or HTML code the main donation page, success page and cancel page. Also you can define Language keys.

All options are manageable from ACP]]></description>
		<description lang="fr"><![CDATA[Avec ce MOD vous pouvez :
- Activer/désactiver les statistisques des dons (Bar de progression, dons reçus, objectif des dons à atteindre) de la page des Dons. En option, il est possible d'afficher les stats en bas de l'index du forum.
- Gérer les devises que vous souhaiter activer
- Retourner automatiquement vers le forum si la soumission du don a été validé avec succès ou abondonné.
- Personnaliser avec un texte ou du code HTML la page des dons, ainsi que les pages de retour au forum (Validation/annulation de dons).

Toutes les options sont administrables depuis l'ACP]]></description>
		<author-notes lang="en"><![CDATA[
This MOD is inspired by the Stocker 4.0 Donation MOD.
Some displayed features have been kept :
- Stats
- Customizable pages with text]]>
		</author-notes>
		<author-notes lang="fr"><![CDATA[
Ce MOD est inspiré de "Paypal Donation" de Stocker 4.0.
Certaines fonctionnalités ont été gardées :
- Visualisation des statistiques
- Personalisation des pages avec du texte]]>
		</author-notes>
		<author-group>
			<author>
				<realname><![CDATA[Skouat]]></realname>
				<username><![CDATA[Skouat]]></username>
				<homepage><![CDATA[http://www.ultima-flyff.com]]></homepage>
				<contributions-group>
					<contributions status="current" from="2012-01-14" position="Developer"/>
				</contributions-group>
			</author>
		</author-group>

		<mod-version>1.0.0-RC1</mod-version>

		<installation>
			<level>easy</level>
			<time>300</time>
			<target-version>3.0.10</target-version>
		</installation>

		<history>
			<entry>
				<date>2012-01-15</date>
				<rev-version>1.0.0-RC1</rev-version>
				<changelog lang="en">
					<change>First public version..</change>
				</changelog>
			</entry>
		</history>
		<link-group>
			<link type="language" href="./language/fr.xml" lang="en">fr_FR</link>
		</link-group>
	</header>
	<action-group>
		<copy>
			<file from="root/donate.php" to="donate.php" />
			<file from="root/install_donation_mod.php" to="install_donation_mod.php" />
			<file from="root/adm/style/acp_donation.html" to="adm/style/acp_donation.html" />
			<file from="root/images/donation/*.*" to="images/donation/*.*" />
			<file from="root/includes/acp/*.*" to="includes/acp/*.*" />
			<file from="root/includes/functions_donation.php" to="includes/functions_donation.php" />
			<file from="root/language/en/mods/*.*" to="language/en/mods/*.*" />
			<file from="root/styles/prosilver/imageset/en/donate.gif" to="styles/prosilver/imageset/en/donate.gif" />
			<file from="root/styles/prosilver/template/donate/*.*" to="styles/prosilver/template/donate/*.*" />
			<file from="root/styles/prosilver/theme/donation.css" to="styles/prosilver/theme/donation.css" />
			<file from="root/umil/*.*" to="umil/*.*" />
		</copy>
		<open src="index.php">
			<edit>
				<find><![CDATA[$user->setup('viewforum');]]></find>
				<action type="after-add"><![CDATA[//-- mod : Paypal donation --------------------------------------------------------
//-- add

// Check for MOD installed
if (!isset($config['donation_enable']) || !isset($config['donation_mod_version']))
{
	$user->setup('mods/donate');
	if($user->data['user_type'] == USER_FOUNDER)
	{
		$installer =  append_sid("{$phpbb_root_path}install_donation_mod.$phpEx");
		$message = sprintf($user->lang['DONATION_NOT_INSTALLED'], '<a href="' . $installer . '">', '</a>');
	}
	else
	{
		$message = $user->lang['DONATION_NOT_INSTALLED_USER'];
	}
	trigger_error ($message);
}
elseif ($config['donation_enable'] && $config['donation_stats_index_enable'])
{
	include($phpbb_root_path . 'includes/functions_donation.' . $phpEx);
}
//-- end : Paypal donation --------------------------------------------------------
]]></action>
			</edit>
			<edit>
				<find><![CDATA[// Output page]]></find>
				<action type="before-add"><![CDATA[//-- mod : Paypal donation --------------------------------------------------------
//-- add
if ($config['donation_enable'] && $config['donation_stats_index_enable'])
{
	$user->add_lang('mods/donate');
	$template->assign_vars(array(
		'DONATION_STATS_INDEX_ENABLE'	=> $config['donation_stats_index_enable'],
		'DONATION_RAISED_ENABLE'		=> $config['donation_raised_enable'],
		'DONATION_RAISED'				=> $config['donation_raised'],
		'DONATION_GOAL_ENABLE'			=> $config['donation_goal_enable'],
		'DONATION_GOAL'					=> $config['donation_goal'],
		'DONATION_USED_ENABLE'			=> $config['donation_used_enable'],
		'DONATION_USED'					=> $config['donation_used'],
		'DONATION_CURRENCY_ENABLE'		=> $config['donation_currency_enable'],
		'DONATION_CURRENCY'				=> donation_item_list($config['donation_default_currency'], 'currency', 'default_currency', $user->lang['CURRENCY_DEFAULT']),
	));

		if ($config['donation_goal_enable'])
		{
			donation_goal_number();
		}

		if ($config['donation_used_enable'])
		{
			donation_used_number();
		}
}
//-- end : Paypal donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="viewonline.php">
			<edit>
				<find><![CDATA[		default:
			$location = $user->lang['INDEX'];
			$location_url = append_sid("{$phpbb_root_path}index.$phpEx");
		break;]]></find>
				<action type="before-add"><![CDATA[//-- mod : Paypal Donation --------------------------------------------------------
//-- add
		case 'donate':
			$location = $user->lang['VIEWING_DONATE'];
			$location_url = append_sid("{$phpbb_root_path}donate.$phpEx");
		break;
//-- end : Paypal Donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="includes/constants.php">
			<edit>
				<find><![CDATA[// Additional tables]]></find>
				<action type="after-add"><![CDATA[//-- mod : Paypal Donation --------------------------------------------------------
//-- add
define('DONATION_ITEM_TABLE',			$table_prefix . 'donation_item');
//-- end : Paypal Donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="includes/functions.php">
			<edit>
				<find><![CDATA[		'A_COOKIE_SETTINGS'		=> addslashes('; path=' . $config['cookie_path'] . ((!$config['cookie_domain'] || $config['cookie_domain'] == 'localhost' || $config['cookie_domain'] == '127.0.0.1') ? '' : '; domain=' . $config['cookie_domain']) . ((!$config['cookie_secure']) ? '' : '; secure')),
	));
]]></find>
				<action type="after-add"><![CDATA[//-- mod : Paypal Donation --------------------------------------------------------
//-- add
	$template->assign_vars(array(
		'U_DONATE'				=> append_sid("{$phpbb_root_path}donate.$phpEx"),
		'S_DONATE_ENABLED'		=> (!empty($config['donation_enable'])) ? true : false,
	));
//-- end : Paypal Donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="language/en/common.php">
			<edit>
				<find><![CDATA[?>]]></find>
				<action type="before-add"><![CDATA[//-- mod : Paypal Donation --------------------------------------------------------
//-- add
$lang = array_merge($lang, array(
	'DONATEINDEX'				=> 'Donate',
	'VIEWING_DONATE'			=> 'Viewing Donation page',
));
//-- end : Paypal Donation --------------------------------------------------------
]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/index_body.html">
			<edit>
				<find><![CDATA[<!-- IF NEWEST_USER -->]]></find>
				<action type="before-add"><![CDATA[<!-- IF DONATION_STATS_INDEX_ENABLE and (DONATION_RAISED_ENABLE or DONATION_GOAL_ENABLE) -->
	<!-- INCLUDE donate/donate_stats.html -->
<!-- ENDIF -->
]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/overall_header.html">
			<edit>
				<find><![CDATA[				<li class="icon-faq"><a href="{U_FAQ}" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>]]></find>
				<action type="before-add"><![CDATA[				<!-- IF S_DONATE_ENABLED --><li class="icon-bump"><a href="{U_DONATE}">{L_DONATEINDEX}</a></li><!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/theme/stylesheet.css">
			<edit>
				<find><![CDATA[@import url("colours.css");]]></find>
				<action type="after-add"><![CDATA[@import url("donation.css");
]]></action>
			</edit>
		</open>
		<php-installer><![CDATA[install_donation_mod.php]]></php-installer>

		<diy-instructions lang="en"><![CDATA[Upload all included files.
Run the installer.
Go to ACP, refresh your style and purge your cache
Set the Paypal Donation Mod settings under the .MOD tab.]]></diy-instructions>
	</action-group>
</mod>